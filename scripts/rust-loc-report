#!/usr/bin/env bash
# Generate LOC report from cargo warloc output
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
cd "$PROJECT_ROOT"

# Save cargo warloc output to temp file and read it
TMPFILE=$(mktemp)
trap "rm -f $TMPFILE" EXIT

cargo warloc --by-file > "$TMPFILE"

python3 "$SCRIPT_DIR/_rust_loc.py" "$TMPFILE" | npx prettier --parser markdown

